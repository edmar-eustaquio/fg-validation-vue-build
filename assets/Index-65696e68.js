import{b,r as y,d as ae,s as ne,e as E,o as i,i as p,g as r,w as s,u as t,F as k,f as e,a as n,j as M,c as w,t as u,q as se}from"./app-512db043.js";import{k as B,_ as oe,l as A,E as I}from"./AuthenticatedLayout-3abc894e.js";import{b as x,E as ue,a as re}from"./index-ec8fda9a.js";import{E as W}from"./index-f1f173d8.js";import{E as ie,a as O}from"./index-0112bd35.js";import{E as L}from"./index-3cc4760d.js";import"./index-ab4f1430.js";import"./validator-71cf8062.js";import"./index-ac2f0de8.js";const ce={class:"container"},de={class:"row"},fe={class:"m-5 flex"},me={class:"flex justify-between"},_e={key:0,class:"mx-5 flex justify-between"},ve={class:"font-semibold text-[15px]"},pe={class:"font-semibold text-[15px]"},he={class:"row mt-2"},ge=e("div",{class:"text-xl font-semibold m-5"},"Confirmation Status",-1),be=e("span",null,"Delivery:",-1),ye=e("br",null,null,-1),ke=e("span",null,"SO Number:",-1),we=e("br",null,null,-1),xe=e("span",null,"Cust PO No:",-1),Se=e("br",null,null,-1),Ce=e("span",null,"Customer Name:",-1),Ee=e("br",null,null,-1),Ne=e("span",null,"Item Code:",-1),Ve=e("br",null,null,-1),Te=e("span",null,"Item Description:",-1),Me=e("br",null,null,-1),Be=e("span",null,"Customer's Own Serial Number:",-1),Ie=e("br",null,null,-1),Oe=e("span",null,"Serial Number:",-1),Re=e("br",null,null,-1),We=e("span",null,"RFID:",-1),ze={class:"flex justify-end"},qe={__name:"Index",props:["scanning_tag","ip_address"],setup(q){b("");const c=b(null),S=b(!0),m=b(!1);let d=y({}),h=y({}),g=y({});const z=y({value:[]});let C=!1;const D=y({}),N=b(!1),_=b(null),f=y({}),{scanning_tag:F,ip_address:G}=q,$=new FileReader;$.onload=function(a){const o=a.target.result,l=o.includes("hold"),v=o.includes("confirm");if((l||v)&&P(),o.split("|")[0]==c.value){if(l)_.value="On Hold - "+o.split("-")[1];else if(v){const H=o.split("-")[1].trim();_.value="Confirmed"+(H.length==0?"":" - "+H),c.value=null,setTimeout(()=>{_.value=null},5e3)}}};function J(a){return a===0?"Hold":a===1?"Confirmed":"Pending"}const V=a=>{if(!m.value&&a){X(a);return}C||!c.value||E.get(route("asset.get-by-truck-no",{truck:c.value})).then(async o=>{d.value=o.data.data,h.value=o.data.mismatched,!d.value.some(l=>l.scanned==0)&&d.value.length>0&&!C&&(C=!0,B({type:"success",message:"All items are validated."}))})},T=new WebSocket(`ws://${G}:8888`);ae(()=>{m.value=F!=null,c.value=F,P(),c.value&&(S.value=!1,V(),setTimeout(()=>{R()},1e3*60)),U(),K()}),ne(()=>{Q()});function K(){T.onmessage=V,T.onerror=()=>{B({type:"error",message:"Having problem in realtime server"})}}function Q(){T.readyState===WebSocket.OPEN&&T.close()}function X(a){$.readAsText(a.data)}function Y(){if(!c.value){d.value=[];return}S.value=!0,V()}function Z(){let a=0;return(d.value??[]).forEach(l=>{l.scanned&&a++}),a}const j=a=>{f.value=a,N.value=!0};function P(){E.get(route("confirmation.today")).then(a=>{z.value=a.data.data})}const U=()=>{E.get(route("truck.get-truck-nos")).then(a=>{D.value=a.data.data,console.log(a.data.data)})},ee=()=>{g.value=null,C=!1,S.value=!1,E.post(route("scanning-tag.create"),{to_validate_truck_no:c.value}).then(()=>{V(),m.value=!0,setTimeout(()=>{R()},1e3*60)}).catch(()=>{B({type:"error",message:"Error occurs!!!"})})};function R(){console.log(d.value,C,h.value);const a=!d.value.some(o=>o.scanned==0)&&d.value.length>0&&(!h.value||h.value.length==0);a&&(_.value="Waiting for confirmation..."),le(a)}const le=async a=>{g.value=d.value,E.post(route("scanning-tag.delete")).then(()=>{U(),m.value=!1,a||(c.value=null)}).catch(()=>{B({type:"error",message:"Error occurs!!!"})})},te=()=>{window.location.href=route("export.asset",{export_type:"excel",data:g.value}),g.value=null};return(a,o)=>(i(),p(k,null,[r(oe,null,{default:s(()=>[e("div",ce,[e("div",de,[e("div",fe,[n(" Legend : "),r(t(x),{type:"success",class:"mr-2"},{default:s(()=>[n(" Match ")]),_:1}),r(t(x),{type:"danger",class:"mr-2"},{default:s(()=>[n(" Missing ")]),_:1}),r(t(x),{type:"warning",class:"mr-2"},{default:s(()=>[n(" Mismatch ")]),_:1})]),r(t(W),{class:"m-5",shadow:"always"},{default:s(()=>[e("div",me,[e("div",null,[r(t(ue),{disabled:m.value,modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=l=>c.value=l),filterable:"",placeholder:"Select truck no.",clearable:"",onChange:Y,class:"mr-2"},{default:s(()=>[(i(!0),p(k,null,M(D.value??[],l=>(i(),w(t(re),{label:l.truck_no,value:l.id},null,8,["label","value"]))),256))]),_:1},8,["disabled","modelValue"]),m.value?(i(),w(t(I),{key:1,type:"primary",icon:t(A),onClick:R},{default:s(()=>[n("Stop Scanning")]),_:1},8,["icon"])):(i(),w(t(I),{key:0,disabled:!c.value,type:"primary",icon:t(A),onClick:ee},{default:s(()=>[n("Start Scanning")]),_:1},8,["disabled","icon"])),r(t(I),{disabled:!t(g).value||t(g).value.length==0||m.value,onClick:te},{default:s(()=>[n(" Export ")]),_:1},8,["disabled"])])])]),_:1})]),S.value?se("",!0):(i(),p("div",_e,[e("div",ve,u(Z())+" / "+u((t(d).value??[]).length)+" matched ",1),e("div",pe," Mismatch: "+u((t(h).value??[]).length),1)])),e("div",he,[r(t(W),{class:"mx-5",shadow:"always"},{default:s(()=>[S.value?(i(!0),p(k,{key:0},M(t(d).value??[],l=>(i(),w(t(x),{type:"info",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"},onClick:v=>j(l)},{default:s(()=>[n(u(l.serial_no),1)]),_:2},1032,["onClick"]))),256)):(i(),p(k,{key:1},[(i(!0),p(k,null,M(t(d).value??[],l=>(i(),w(t(x),{type:l.scanned?"success":"danger",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"},onClick:v=>j(l)},{default:s(()=>[n(u(l.serial_no),1)]),_:2},1032,["type","onClick"]))),256)),(i(!0),p(k,null,M(t(h).value??[],l=>(i(),w(t(x),{type:"warning",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"}},{default:s(()=>[n(u(l),1)]),_:2},1024))),256))],64))]),_:1})]),ge,r(t(W),{class:"m-5",shadow:"always"},{default:s(()=>[r(t(ie),{data:z.value,"row-key":"id","header-row-class-name":"thead-light"},{default:s(()=>[r(t(O),{"min-width":"100px",label:"Truck No."},{default:s(({row:l})=>[n(u(l.truck.truck_no),1)]),_:1}),r(t(O),{"min-width":"220px",label:"Reason"},{default:s(({row:l})=>[n(u(l.reason),1)]),_:1}),r(t(O),{"min-width":"150px",label:"Confirmed By"},{default:s(({row:l})=>{var v;return[n(u((v=l.confirmed_by)==null?void 0:v.name),1)]}),_:1}),r(t(O),{"min-width":"80px",label:"Status"},{default:s(({row:l})=>[n(u(J(l.is_confirmed)),1)]),_:1})]),_:1},8,["data"])]),_:1})])]),_:1}),r(t(L),{width:"500px",modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=l=>N.value=l),title:"More Information"},{footer:s(()=>[e("span",ze,[r(t(I),{type:"info",onClick:o[1]||(o[1]=l=>N.value=!1),plain:""},{default:s(()=>[n("Ok")]),_:1})])]),default:s(()=>[e("div",null,[be,e("span",null,u(f.value.dr_number),1),n(),ye,ke,e("span",null,u(f.value.so_no),1),n(),we,xe,e("span",null,u(f.value.cust_po_no),1),n(),Se,Ce,e("span",null,u(f.value.sold_to),1),n(),Ee,Ne,e("span",null,u(f.value.item_number),1),n(),Ve,Te,e("span",null,u(f.value.description),1),n(),Me,Be,e("span",null,u(f.value.company_code),1),n(),Ie,Oe,e("span",null,u(f.value.serial_no),1),n(),Re,We,n(),e("span",null,u(f.value.rfid),1)])]),_:1},8,["modelValue"]),r(t(L),{width:"500px",modelValue:_.value,"onUpdate:modelValue":o[3]||(o[3]=l=>_.value=l),title:_.value},null,8,["modelValue","title"])],64))}};export{qe as default};
