import{b,r as y,d as te,s as ae,e as E,o as r,i as p,g as i,w as s,u as a,F as k,f as e,a as l,j as M,c as x,t as u,q as ne}from"./app-f2ca105d.js";import{k as B,_ as se,l as H,E as R}from"./AuthenticatedLayout-400f78dc.js";import{b as w,E as oe,a as ue}from"./index-b7c2bda2.js";import{E as D}from"./index-2988b552.js";import{E as ie,a as W}from"./index-68852108.js";import{E as L}from"./index-67070b2f.js";import"./index-58716ada.js";import"./scroll-243fa0a2.js";import"./validator-5ab5afb4.js";import"./index-128caf0f.js";const re={class:"container"},ce={class:"row"},de={class:"m-5 flex"},fe={class:"flex justify-between"},me={key:0,class:"mx-5 flex justify-between"},_e={class:"font-semibold text-[15px]"},ve={class:"font-semibold text-[15px]"},pe={class:"row mt-2"},he=e("div",{class:"text-xl font-semibold m-5"},"Confirmation Status",-1),ge=e("span",null,"DR Number:",-1),be=e("br",null,null,-1),ye=e("span",null,"SO Number:",-1),ke=e("br",null,null,-1),xe=e("span",null,"Cust PO No:",-1),we=e("br",null,null,-1),Se=e("span",null,"Sold To:",-1),Ce=e("br",null,null,-1),Ee=e("span",null,"Diverted To:",-1),Ne=e("br",null,null,-1),Ve=e("span",null,"Item Number:",-1),Te=e("br",null,null,-1),Me=e("span",null,"Description:",-1),Be=e("br",null,null,-1),Re=e("span",null,"Company Code:",-1),We=e("br",null,null,-1),ze=e("span",null,"Serial No.:",-1),De=e("br",null,null,-1),Ie=e("span",null,"RFID:",-1),Oe={class:"flex justify-end"},Je={__name:"Index",props:["scanning_tag"],setup(q){b("");const c=b(null),S=b(!0),m=b(!1);let d=y({}),h=y({}),g=y({});const I=y({value:[]});let C=!1;const O=y({}),N=b(!1),_=b(null),f=y({}),{scanning_tag:F}=q,j=new FileReader;j.onload=function(n){const o=n.target.result,t=o.includes("hold"),v=o.includes("confirm");if((t||v)&&U(),o.split("|")[0]==c.value){if(t)_.value="On Hold - "+o.split("-")[1];else if(v){const A=o.split("-")[1].trim();_.value="Confirmed"+(A.length==0?"":" - "+A),c.value=null,setTimeout(()=>{_.value=null},5e3)}}};function G(n){return n===0?"Hold":n===1?"Confirmed":"Pending"}const V=n=>{if(!m.value&&n){Q(n);return}C||!c.value||E.get(route("asset.get-by-truck-no",{truck:c.value})).then(async o=>{d.value=o.data.data,h.value=o.data.mismatched,!d.value.some(t=>t.scanned==0)&&d.value.length>0&&!C&&(C=!0,B({type:"success",message:"All items are validated."}))})},T=new WebSocket("ws://192.168.0.71:8888");te(()=>{m.value=F!=null,c.value=F,U(),c.value&&(S.value=!1,V(),setTimeout(()=>{z()},1e3*60)),$(),J()}),ae(()=>{K()});function J(){T.onmessage=V,T.onerror=()=>{B({type:"error",message:"Having problem in realtime server"})}}function K(){T.readyState===WebSocket.OPEN&&T.close()}function Q(n){j.readAsText(n.data)}function X(){if(!c.value){d.value=[];return}S.value=!0,V()}function Y(){let n=0;return(d.value??[]).forEach(t=>{t.scanned&&n++}),n}const P=n=>{f.value=n,N.value=!0};function U(){E.get(route("confirmation.today")).then(n=>{I.value=n.data.data})}const $=()=>{E.get(route("truck.get-truck-nos")).then(n=>{O.value=n.data.data,console.log(n.data.data)})},Z=()=>{g.value=null,C=!1,S.value=!1,E.post(route("scanning-tag.create"),{to_validate_truck_no:c.value}).then(()=>{V(),m.value=!0,setTimeout(()=>{z()},1e3*60)}).catch(()=>{B({type:"error",message:"Error occurs!!!"})})};function z(){console.log(d.value,C,h.value);const n=!d.value.some(o=>o.scanned==0)&&d.value.length>0&&(!h.value||h.value.length==0);n&&(_.value="Waiting for confirmation..."),ee(n)}const ee=async n=>{g.value=d.value,E.post(route("scanning-tag.delete")).then(()=>{$(),m.value=!1,n||(c.value=null)}).catch(()=>{B({type:"error",message:"Error occurs!!!"})})},le=()=>{window.location.href=route("export.asset",{export_type:"excel",data:g.value}),g.value=null};return(n,o)=>(r(),p(k,null,[i(se,null,{default:s(()=>[e("div",re,[e("div",ce,[e("div",de,[l(" Legend : "),i(a(w),{type:"success",class:"mr-2"},{default:s(()=>[l(" Match ")]),_:1}),i(a(w),{type:"danger",class:"mr-2"},{default:s(()=>[l(" Missing ")]),_:1}),i(a(w),{type:"warning",class:"mr-2"},{default:s(()=>[l(" Mismatch ")]),_:1})]),i(a(D),{class:"m-5",shadow:"always"},{default:s(()=>[e("div",fe,[e("div",null,[i(a(oe),{disabled:m.value,modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=t=>c.value=t),filterable:"",placeholder:"Select truck no.",clearable:"",onChange:X,class:"mr-2"},{default:s(()=>[(r(!0),p(k,null,M(O.value??[],t=>(r(),x(a(ue),{label:t.truck_no,value:t.id},null,8,["label","value"]))),256))]),_:1},8,["disabled","modelValue"]),m.value?(r(),x(a(R),{key:1,type:"primary",icon:a(H),onClick:z},{default:s(()=>[l("Stop Scanning")]),_:1},8,["icon"])):(r(),x(a(R),{key:0,disabled:!c.value,type:"primary",icon:a(H),onClick:Z},{default:s(()=>[l("Start Scanning")]),_:1},8,["disabled","icon"])),i(a(R),{disabled:!a(g).value||a(g).value.length==0||m.value,onClick:le},{default:s(()=>[l(" Export ")]),_:1},8,["disabled"])])])]),_:1})]),S.value?ne("",!0):(r(),p("div",me,[e("div",_e,u(Y())+" / "+u((a(d).value??[]).length)+" matched",1),e("div",ve,"Mismatch: "+u((a(h).value??[]).length),1)])),e("div",pe,[i(a(D),{class:"mx-5",shadow:"always"},{default:s(()=>[S.value?(r(!0),p(k,{key:0},M(a(d).value??[],t=>(r(),x(a(w),{type:"info",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"},onClick:v=>P(t)},{default:s(()=>[l(u(t.serial_no),1)]),_:2},1032,["onClick"]))),256)):(r(),p(k,{key:1},[(r(!0),p(k,null,M(a(d).value??[],t=>(r(),x(a(w),{type:t.scanned?"success":"danger",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"},onClick:v=>P(t)},{default:s(()=>[l(u(t.serial_no),1)]),_:2},1032,["type","onClick"]))),256)),(r(!0),p(k,null,M(a(h).value??[],t=>(r(),x(a(w),{type:"warning",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"}},{default:s(()=>[l(u(t),1)]),_:2},1024))),256))],64))]),_:1})]),he,i(a(D),{class:"m-5",shadow:"always"},{default:s(()=>[i(a(ie),{data:I.value,"row-key":"id","header-row-class-name":"thead-light"},{default:s(()=>[i(a(W),{"min-width":"100px",label:"Truck No."},{default:s(({row:t})=>[l(u(t.truck.truck_no),1)]),_:1}),i(a(W),{"min-width":"220px",label:"Reason"},{default:s(({row:t})=>[l(u(t.reason),1)]),_:1}),i(a(W),{"min-width":"150px",label:"Confirmed By"},{default:s(({row:t})=>{var v;return[l(u((v=t.confirmed_by)==null?void 0:v.name),1)]}),_:1}),i(a(W),{"min-width":"80px",label:"Status"},{default:s(({row:t})=>[l(u(G(t.is_confirmed)),1)]),_:1})]),_:1},8,["data"])]),_:1})])]),_:1}),i(a(L),{width:"500px",modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=t=>N.value=t),title:"More Information"},{footer:s(()=>[e("span",Oe,[i(a(R),{type:"info",onClick:o[1]||(o[1]=t=>N.value=!1),plain:""},{default:s(()=>[l("Ok")]),_:1})])]),default:s(()=>[e("div",null,[ge,l(),e("span",null,u(f.value.dr_number),1),l(),be,ye,l(),e("span",null,u(f.value.so_no),1),l(),ke,xe,l(),e("span",null,u(f.value.cust_po_no),1),l(),we,Se,l(),e("span",null,u(f.value.sold_to),1),l(),Ce,Ee,l(),e("span",null,u(f.value.diverted_to),1),l(),Ne,Ve,l(),e("span",null,u(f.value.item_number),1),l(),Te,Me,l(),e("span",null,u(f.value.description),1),l(),Be,Re,l(),e("span",null,u(f.value.company_code),1),l(),We,ze,l(),e("span",null,u(f.value.serial_no),1),l(),De,Ie,l(),e("span",null,u(f.value.rfid),1)])]),_:1},8,["modelValue"]),i(a(L),{width:"500px",modelValue:_.value,"onUpdate:modelValue":o[3]||(o[3]=t=>_.value=t),title:_.value},null,8,["modelValue","title"])],64))}};export{Je as default};
