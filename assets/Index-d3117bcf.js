import{b,r as y,d as te,s as ae,e as E,o as i,i as p,g as r,w as s,u as t,F as k,f as e,a as n,j as M,c as w,t as u,q as ne}from"./app-2f9d10f9.js";import{k as B,_ as se,l as A,E as I}from"./AuthenticatedLayout-e9870fba.js";import{b as x,E as oe,a as ue}from"./index-2299c81e.js";import{E as W}from"./index-b2bd8d2c.js";import{E as re,a as O}from"./index-77e36d3c.js";import{E as L}from"./index-a89ca195.js";import"./index-345c38df.js";import"./validator-fab8e9c6.js";import"./index-5d88026c.js";const ie={class:"container"},ce={class:"row"},de={class:"m-5 flex"},fe={class:"flex justify-between"},me={key:0,class:"mx-5 flex justify-between"},ve={class:"font-semibold text-[15px]"},_e={class:"font-semibold text-[15px]"},pe={class:"row mt-2"},he=e("div",{class:"text-xl font-semibold m-5"},"Confirmation Status",-1),ge=e("span",null,"Delivery:",-1),be=e("br",null,null,-1),ye=e("span",null,"SO Number:",-1),ke=e("br",null,null,-1),we=e("span",null,"Cust PO No:",-1),xe=e("br",null,null,-1),Se=e("span",null,"Customer Name:",-1),Ce=e("br",null,null,-1),Ee=e("span",null,"Item Code:",-1),Ne=e("br",null,null,-1),Ve=e("span",null,"Item Description:",-1),Te=e("br",null,null,-1),Me=e("span",null,"Customer's Own Serial Number:",-1),Be=e("br",null,null,-1),Ie=e("span",null,"Serial Number:",-1),Oe=e("br",null,null,-1),Re=e("span",null,"RFID:",-1),We={class:"flex justify-end"},Le={__name:"Index",props:["scanning_tag"],setup(q){b("");const c=b(null),S=b(!0),m=b(!1);let d=y({}),h=y({}),g=y({});const z=y({value:[]});let C=!1;const D=y({}),N=b(!1),v=b(null),f=y({}),{scanning_tag:F}=q,j=new FileReader;j.onload=function(a){const o=a.target.result,l=o.includes("hold"),_=o.includes("confirm");if((l||_)&&U(),o.split("|")[0]==c.value){if(l)v.value="On Hold - "+o.split("-")[1];else if(_){const H=o.split("-")[1].trim();v.value="Confirmed"+(H.length==0?"":" - "+H),c.value=null,setTimeout(()=>{v.value=null},5e3)}}};function G(a){return a===0?"Hold":a===1?"Confirmed":"Pending"}const V=a=>{if(!m.value&&a){Q(a);return}C||!c.value||E.get(route("asset.get-by-truck-no",{truck:c.value})).then(async o=>{d.value=o.data.data,h.value=o.data.mismatched,!d.value.some(l=>l.scanned==0)&&d.value.length>0&&!C&&(C=!0,B({type:"success",message:"All items are validated."}))})},T=new WebSocket("ws://192.168.0.71:8888");te(()=>{m.value=F!=null,c.value=F,U(),c.value&&(S.value=!1,V(),setTimeout(()=>{R()},1e3*60)),$(),J()}),ae(()=>{K()});function J(){T.onmessage=V,T.onerror=()=>{B({type:"error",message:"Having problem in realtime server"})}}function K(){T.readyState===WebSocket.OPEN&&T.close()}function Q(a){j.readAsText(a.data)}function X(){if(!c.value){d.value=[];return}S.value=!0,V()}function Y(){let a=0;return(d.value??[]).forEach(l=>{l.scanned&&a++}),a}const P=a=>{f.value=a,N.value=!0};function U(){E.get(route("confirmation.today")).then(a=>{z.value=a.data.data})}const $=()=>{E.get(route("truck.get-truck-nos")).then(a=>{D.value=a.data.data,console.log(a.data.data)})},Z=()=>{g.value=null,C=!1,S.value=!1,E.post(route("scanning-tag.create"),{to_validate_truck_no:c.value}).then(()=>{V(),m.value=!0,setTimeout(()=>{R()},1e3*60)}).catch(()=>{B({type:"error",message:"Error occurs!!!"})})};function R(){console.log(d.value,C,h.value);const a=!d.value.some(o=>o.scanned==0)&&d.value.length>0&&(!h.value||h.value.length==0);a&&(v.value="Waiting for confirmation..."),ee(a)}const ee=async a=>{g.value=d.value,E.post(route("scanning-tag.delete")).then(()=>{$(),m.value=!1,a||(c.value=null)}).catch(()=>{B({type:"error",message:"Error occurs!!!"})})},le=()=>{window.location.href=route("export.asset",{export_type:"excel",data:g.value}),g.value=null};return(a,o)=>(i(),p(k,null,[r(se,null,{default:s(()=>[e("div",ie,[e("div",ce,[e("div",de,[n(" Legend : "),r(t(x),{type:"success",class:"mr-2"},{default:s(()=>[n(" Match ")]),_:1}),r(t(x),{type:"danger",class:"mr-2"},{default:s(()=>[n(" Missing ")]),_:1}),r(t(x),{type:"warning",class:"mr-2"},{default:s(()=>[n(" Mismatch ")]),_:1})]),r(t(W),{class:"m-5",shadow:"always"},{default:s(()=>[e("div",fe,[e("div",null,[r(t(oe),{disabled:m.value,modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=l=>c.value=l),filterable:"",placeholder:"Select truck no.",clearable:"",onChange:X,class:"mr-2"},{default:s(()=>[(i(!0),p(k,null,M(D.value??[],l=>(i(),w(t(ue),{label:l.truck_no,value:l.id},null,8,["label","value"]))),256))]),_:1},8,["disabled","modelValue"]),m.value?(i(),w(t(I),{key:1,type:"primary",icon:t(A),onClick:R},{default:s(()=>[n("Stop Scanning")]),_:1},8,["icon"])):(i(),w(t(I),{key:0,disabled:!c.value,type:"primary",icon:t(A),onClick:Z},{default:s(()=>[n("Start Scanning")]),_:1},8,["disabled","icon"])),r(t(I),{disabled:!t(g).value||t(g).value.length==0||m.value,onClick:le},{default:s(()=>[n(" Export ")]),_:1},8,["disabled"])])])]),_:1})]),S.value?ne("",!0):(i(),p("div",me,[e("div",ve,u(Y())+" / "+u((t(d).value??[]).length)+" matched ",1),e("div",_e," Mismatch: "+u((t(h).value??[]).length),1)])),e("div",pe,[r(t(W),{class:"mx-5",shadow:"always"},{default:s(()=>[S.value?(i(!0),p(k,{key:0},M(t(d).value??[],l=>(i(),w(t(x),{type:"info",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"},onClick:_=>P(l)},{default:s(()=>[n(u(l.serial_no),1)]),_:2},1032,["onClick"]))),256)):(i(),p(k,{key:1},[(i(!0),p(k,null,M(t(d).value??[],l=>(i(),w(t(x),{type:l.scanned?"success":"danger",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"},onClick:_=>P(l)},{default:s(()=>[n(u(l.serial_no),1)]),_:2},1032,["type","onClick"]))),256)),(i(!0),p(k,null,M(t(h).value??[],l=>(i(),w(t(x),{type:"warning",size:"large",class:"mr-2 mb-2 cursor-pointer",style:{"font-size":"larger"}},{default:s(()=>[n(u(l),1)]),_:2},1024))),256))],64))]),_:1})]),he,r(t(W),{class:"m-5",shadow:"always"},{default:s(()=>[r(t(re),{data:z.value,"row-key":"id","header-row-class-name":"thead-light"},{default:s(()=>[r(t(O),{"min-width":"100px",label:"Truck No."},{default:s(({row:l})=>[n(u(l.truck.truck_no),1)]),_:1}),r(t(O),{"min-width":"220px",label:"Reason"},{default:s(({row:l})=>[n(u(l.reason),1)]),_:1}),r(t(O),{"min-width":"150px",label:"Confirmed By"},{default:s(({row:l})=>{var _;return[n(u((_=l.confirmed_by)==null?void 0:_.name),1)]}),_:1}),r(t(O),{"min-width":"80px",label:"Status"},{default:s(({row:l})=>[n(u(G(l.is_confirmed)),1)]),_:1})]),_:1},8,["data"])]),_:1})])]),_:1}),r(t(L),{width:"500px",modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=l=>N.value=l),title:"More Information"},{footer:s(()=>[e("span",We,[r(t(I),{type:"info",onClick:o[1]||(o[1]=l=>N.value=!1),plain:""},{default:s(()=>[n("Ok")]),_:1})])]),default:s(()=>[e("div",null,[ge,e("span",null,u(f.value.dr_number),1),n(),be,ye,e("span",null,u(f.value.so_no),1),n(),ke,we,e("span",null,u(f.value.cust_po_no),1),n(),xe,Se,e("span",null,u(f.value.sold_to),1),n(),Ce,Ee,e("span",null,u(f.value.item_number),1),n(),Ne,Ve,e("span",null,u(f.value.description),1),n(),Te,Me,e("span",null,u(f.value.company_code),1),n(),Be,Ie,e("span",null,u(f.value.serial_no),1),n(),Oe,Re,n(),e("span",null,u(f.value.rfid),1)])]),_:1},8,["modelValue"]),r(t(L),{width:"500px",modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=l=>v.value=l),title:v.value},null,8,["modelValue","title"])],64))}};export{Le as default};
